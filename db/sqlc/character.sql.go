// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.20.0
// source: character.sql

package db

import (
	"context"
	"database/sql"

	"github.com/lib/pq"
)

const createCharacter = `-- name: CreateCharacter :one
INSERT INTO characters (
    name,
    short_description,
    world_id,
    system_id
) VALUES (
    $1, $2, $3, $4
) RETURNING id, name, public, created_at, short_description, world_id, system_id
`

type CreateCharacterParams struct {
	Name             string        `json:"name"`
	ShortDescription string        `json:"short_description"`
	WorldID          sql.NullInt32 `json:"world_id"`
	SystemID         sql.NullInt32 `json:"system_id"`
}

func (q *Queries) CreateCharacter(ctx context.Context, arg CreateCharacterParams) (Character, error) {
	row := q.db.QueryRowContext(ctx, createCharacter,
		arg.Name,
		arg.ShortDescription,
		arg.WorldID,
		arg.SystemID,
	)
	var i Character
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Public,
		&i.CreatedAt,
		&i.ShortDescription,
		&i.WorldID,
		&i.SystemID,
	)
	return i, err
}

const deleteCharacter = `-- name: DeleteCharacter :exec
DELETE FROM characters WHERE id = $1
`

func (q *Queries) DeleteCharacter(ctx context.Context, characterID int32) error {
	_, err := q.db.ExecContext(ctx, deleteCharacter, characterID)
	return err
}

const getCharacterByID = `-- name: GetCharacterByID :one
SELECT id, name, public, created_at, short_description, world_id, system_id FROM characters WHERE id = $1 LIMIT 1
`

func (q *Queries) GetCharacterByID(ctx context.Context, characterID int32) (Character, error) {
	row := q.db.QueryRowContext(ctx, getCharacterByID, characterID)
	var i Character
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Public,
		&i.CreatedAt,
		&i.ShortDescription,
		&i.WorldID,
		&i.SystemID,
	)
	return i, err
}

const getCharacters = `-- name: GetCharacters :many
SELECT id, name, public, created_at, short_description, world_id, system_id, module_id, menu_id, header_img_id, thumbnail_img_id, avatar_img_id, tags FROM get_characters($1::boolean, $2::integer[], $3::integer, $4::integer, $5::VARCHAR, 'DESC', $6, $7)
`

type GetCharactersParams struct {
	IsPublic   bool    `json:"is_public"`
	Tags       []int32 `json:"tags"`
	WorldID    int32   `json:"world_id"`
	SystemID   int32   `json:"system_id"`
	OrderBy    string  `json:"order_by"`
	PageLimit  int32   `json:"page_limit"`
	PageOffset int32   `json:"page_offset"`
}

func (q *Queries) GetCharacters(ctx context.Context, arg GetCharactersParams) ([]ViewCharacter, error) {
	rows, err := q.db.QueryContext(ctx, getCharacters,
		arg.IsPublic,
		pq.Array(arg.Tags),
		arg.WorldID,
		arg.SystemID,
		arg.OrderBy,
		arg.PageLimit,
		arg.PageOffset,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ViewCharacter{}
	for rows.Next() {
		var i ViewCharacter
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Public,
			&i.CreatedAt,
			&i.ShortDescription,
			&i.WorldID,
			&i.SystemID,
			&i.ModuleID,
			&i.MenuID,
			&i.HeaderImgID,
			&i.ThumbnailImgID,
			&i.AvatarImgID,
			pq.Array(&i.Tags),
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getCharactersByIDs = `-- name: GetCharactersByIDs :many
SELECT id, name, public, created_at, short_description, world_id, system_id FROM characters WHERE id = ANY($1::int[])
`

func (q *Queries) GetCharactersByIDs(ctx context.Context, characterIds []int32) ([]Character, error) {
	rows, err := q.db.QueryContext(ctx, getCharactersByIDs, pq.Array(characterIds))
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Character{}
	for rows.Next() {
		var i Character
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Public,
			&i.CreatedAt,
			&i.ShortDescription,
			&i.WorldID,
			&i.SystemID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getCharactersCount = `-- name: GetCharactersCount :one
SELECT COUNT(*) FROM view_characters
WHERE ($1::boolean IS NULL OR public = $1) AND
    (array_length($2::integer[], 1) IS NULL OR tags @> $2::integer[])
`

type GetCharactersCountParams struct {
	IsPublic bool    `json:"is_public"`
	Tags     []int32 `json:"tags"`
}

func (q *Queries) GetCharactersCount(ctx context.Context, arg GetCharactersCountParams) (int64, error) {
	row := q.db.QueryRowContext(ctx, getCharactersCount, arg.IsPublic, pq.Array(arg.Tags))
	var count int64
	err := row.Scan(&count)
	return count, err
}

const updateCharacter = `-- name: UpdateCharacter :one
UPDATE characters
SET
    name = COALESCE($1, name),
    short_description = COALESCE($2, short_description),
    public = COALESCE($3, public),
    world_id = COALESCE($4, world_id),
    system_id = COALESCE($5, system_id)
WHERE
    id = $6
    RETURNING id, name, public, created_at, short_description, world_id, system_id
`

type UpdateCharacterParams struct {
	Name             sql.NullString `json:"name"`
	ShortDescription sql.NullString `json:"short_description"`
	Public           sql.NullBool   `json:"public"`
	WorldID          sql.NullInt32  `json:"world_id"`
	SystemID         sql.NullInt32  `json:"system_id"`
	CharacterID      int32          `json:"character_id"`
}

func (q *Queries) UpdateCharacter(ctx context.Context, arg UpdateCharacterParams) (Character, error) {
	row := q.db.QueryRowContext(ctx, updateCharacter,
		arg.Name,
		arg.ShortDescription,
		arg.Public,
		arg.WorldID,
		arg.SystemID,
		arg.CharacterID,
	)
	var i Character
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Public,
		&i.CreatedAt,
		&i.ShortDescription,
		&i.WorldID,
		&i.SystemID,
	)
	return i, err
}
